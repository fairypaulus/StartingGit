<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  </style>
  </head>
  <body>
    <form id="addForm" class="container mb-3 text-center ">
       <h1 class="text-center">DETAILS</h1>
    <label style="font-weight: bold;" >NAME:</label>
    <input type="text" id="nameid" required>
    <label style="font-weight: bold;" >EMAIL:</label>
    <input type="email" id="emailid">
    <label style="font-weight: bold;">PHONE NUMBER:</label>
    <input type="number" id="phoneid"><br>
    <input type="submit" class="btn btn-dark mt-2 align-content-center" value="Submit" id="subid">
</form>

<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.5.1/axios.min.js"> </script>
<script>

var addform=document.getElementById("addForm");
//create ul
var ul=document.createElement("ul");
ul.id="items";
ul.style="list-style: circle";
ul.className="list-group mt-3";
addform.appendChild(ul);

var itemlist=document.getElementById("items");
addform.addEventListener("submit",addItem);


axios.get('https://crudcrud.com/api/79f946e22d9f49e7834cae979e0b0732/app')
  .then((response) =>{
    if(response.data.length!==0){
  for(var i=0;i<response.data.length;i++){
   var li = document.createElement('li');
  li.className ="list-group-item";
  ul.appendChild(li);
  var dataaxios=response.data[i].nameItem+"-"+response.data[i].emailItem+"-"+response.data[i].phoneItem;
  li.appendChild(document.createTextNode(dataaxios));
  itemlist.appendChild(li);
  }
  }
  })
  .catch((err) => {
    console.log(err.status)
  }
  )


function addItem(e){
  e.preventDefault();

  var nameItem = document.getElementById('nameid').value;
  var emailItem = document.getElementById('emailid').value;
  var phoneItem = document.getElementById('phoneid').value;

  var obj={
    nameItem,
    emailItem,
    phoneItem
  }

  // add data on server
  axios.post('https://crudcrud.com/api/79f946e22d9f49e7834cae979e0b0732/app',obj)
  .then(response => console.log(response.data))
  .catch(err => console.log(err))

//create li and add as ul child
  var li = document.createElement('li');
  li.className ="list-group-item";
  li.id=emailItem;
  ul.appendChild(li);
  var detail=nameItem+"-"+emailItem+"-"+phoneItem;
  li.appendChild(document.createTextNode(detail));
  itemlist.appendChild(li);

  //delete button create 
  var btndel=document.createElement("button");
  btndel.id=emailItem;
  btndel.className="btn btn-danger ms-3 btn-sm float-right delete";
  btndel.appendChild(document.createTextNode("Delete"))
  li.appendChild(btndel);
}

 //removing item from li
 itemlist.addEventListener("click",removeItem); 
   function removeItem(e){
     var li=e.target.parentElement;
if(e.target.classList.contains("delete")){
       itemlist.removeChild(li);
    //    console.log(li.id);
       for(let i=0;i<3;i++){
       let arr = li.childNodes[0].textContent.split('-');
         document.getElementById('nameid').value=arr[0];
         document.getElementById('emailid').value=arr[1];
         document.getElementById('phoneid').value=arr[2];
       }  
     }
     axios.get('https://crudcrud.com/api/79f946e22d9f49e7834cae979e0b0732/app')
     .then((response)=>{
        
        for(var i=0;i<response.data.length;i++){
            if(li.id==response.data[i].emailItem){
                var usid=response.data[i]._id;
                axios.delete(`https://crudcrud.com/api/79f946e22d9f49e7834cae979e0b0732/app/${usid}`)
                .then(res=>console.log(res))
                 .catch(err=>console.log(err))
            }
        }
     })
     .catch(err=>console.log(err))
   }
</script>
</body>
</html>